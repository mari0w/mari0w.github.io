---
layout: post
title: CSRF攻击
categories: [网络安全]
---

CSRF 全称 Cross-Site Request Forgery，意为“跨站请求伪造”，是一种网络攻击手段，可以通过点击恶意链接，就达到被对方操控账号的目的。

我们在登录某个网站账号后，会生成一个身份凭证保存在本地，这个凭证就是 Cookie，用户做任何网页操作，都会自动携带 Cookie 信息到服务器，服务器端根据该信息识别出操作的用户。 既然 Cookie 是自动携带的，就给了不法分子可趁之机，假如我们登录的网站是一个网银，我们捕获到它的转账接口是：

```
https://bank.com/transfer?payee=mari0w&amount=200
```

这个接口代表往 mari0w 账户里打 200 块，那我们只需要让被攻击的用户点击这个链接，链接就会自动带上用户的身份凭证 Cookie 传递到服务端，服务端认为这是用户合法的转账操作，便会打款给 mari0w。

那一般是如何让用户触发这个链接呢？最常见的是把链接藏在一个伪装的网站中，比如招聘、黄色网站等，然后通过社交工具引导用户点击。藏的方式就很多了，可以是一张图片，也可以是一段空白的 JS 代码，只要页面被渲染，就直接被执行。

```html
<img src="https://bank.com/transfer?payee=mari0w&amount=200" />
```

当然，除了伪装成网站，还可以藏在浏览器插件里，甚至藏在有 XSS 漏洞的正规网站的评论区。不过随着技术的进步，现在的网站安全防护也比较健全了，针对 CSRF 攻击的防护有很多种措施，比如：

CSRF Token：服务器专门生成个令牌用于识别用户身份，不再单纯使用 Cookie，这样就算请求自动携带了 Cookie 也没用，因为服务端是通过令牌来识别用户身份的。那恶意网站不能直接读到令牌后一并上传吗？这个就受限于浏览器的“同源策略”了，浏览器不允许从当前网站访问另一个网站的缓存，这样直接避免了 CSRF Token 读取。

用户认证：在关键操作之前进行身份校验可以很好的预防跨站攻击，比如转账前图形验证码、手机短信、邮箱验证等。

